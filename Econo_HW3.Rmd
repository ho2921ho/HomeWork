---
title: "Econometric_HW3"
output: html_document
---
### C1
 
(1)  
Var(u|totwrk,educ,age,yngkid,male)  
= Var(u|male) = a0+a1male   
만일 여성이면 male = 0이고 var(u|male=0) = a0  
만일 남성이면 male = 1이고 var(u|male=1) = a0+a1  

(2)  

```{r}
library(wooldridge)
data('sleep75')
```

```{r}
model = lm(sleep~totwrk+educ+age+agesq+yngkid+male, data = sleep75)
```

```{r}
male = sleep75$male == 1
```

```{r}
sd(model$fitted.values[male])
```
```{r}
sd(model$fitted.values[!male])
```
여성의 분산이 더 높다. 

(3) 분산 검정. 

```{r}
x = model$fitted.values[!male] 
y = model$fitted.values[male]

var.test(x, y, ratio=1, alternative="two.sided", conf.level=0.95)
```

등분산 검정 결과 F값이 1.03로 상당히 낮고, p-value가 0.77로 높다. 따라서 신뢰수준 95%에서 귀무가설을 기각할 충분한 증거가 없으며 두 집단의 분산은 유의미하게 다르지 않다. 

### C2

(1)

```{r}
data("hprice1")
library(sandwich)
OLS = lm(price~lotsize+sqrft+bdrms, data = hprice1)

library(lmtest)
coeftest(OLS,vcov=vcovHC(OLS,type = 'HC0'))
```
```{r}
coeftest(OLS)
```

일반적인 모델과 비교했을 때, 가장 큰 차이가 나는 변수는 lotsize이다. 강건한 모델에서는 lotsize의 표준오차가 거의 2배이상 증가하였고, 이로 인해 t-value값이 줄어들어 강건한 모델에서는 lotsize를 유의미하다고 보기 어려워졌다.(sqrft는 두 모델에서 유의미하고 bdrms는 두 모델에서 모두 유의미하지 않다.) 

(2)

```{r}

OLS = lm(log(price)~log(lotsize)+log(sqrft)+bdrms, data = hprice1)
coeftest(OLS,vcov=vcovHC(OLS,type = 'HC0'))
```

```{r}
coeftest(OLS)
```

여전히 견고한 모델의 표준오차가 더 높은 편이지만, 그 전과 달리 log를 한 모델에서는 lotsize변수가 강건한 모델에서도 유의미하다. 

(3)
독립변수에 대해 적절한 변환을 사용하면 이분산성을 완화할 수 있다. 

### C3

```{r}
yhat = OLS$fitted
white = bptest(OLS,~yhat+yhat^2,data=hprice1)
```


```{r}

u2 = OLS$residuals^2
Ru2 = summary(lm(u2 ~ yhat + I(yhat^2)))$r.squared
LM = nrow(hprice1)*Ru2
p.value = 1-pchisq(LM, 2)
print(LM)
p.value
```

LM통계량이 3.447287 정도로 나오며, p-value가 0.178로 homoskedasticity assumption을 기각하기 어렵다. 따라서 8.18식에 따른 모델의 경우, 오차항의 등분산성을 가정할 수 있다. 
